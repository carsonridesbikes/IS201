<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
        <meta name="description" content="" />
        <meta name="author" content="" />
        <title>SmileApp - Flappy Smile</title>
        <link rel="icon" type="image/x-icon" href="../assets/favicon.ico" />
        <!-- Font Awesome icons (free version)-->
        <script src="https://use.fontawesome.com/releases/v6.3.0/js/all.js" crossorigin="anonymous"></script>
        <!-- Google fonts-->
        <link href="https://fonts.googleapis.com/css?family=Varela+Round" rel="stylesheet" />
        <link href="https://fonts.googleapis.com/css?family=Nunito:200,200i,300,300i,400,400i,600,600i,700,700i,800,800i,900,900i" rel="stylesheet" />
        <!-- Core theme CSS (includes Bootstrap)-->
        <link href="../css/styles.css" rel="stylesheet" />
        <style>
            #gameCanvas {
                border: 2px solid #000;
                background: #87CEEB;
                display: block;
                margin: 0 auto;
                max-width: 100%;
                height: auto;
            }
            .game-container {
                text-align: center;
                padding: 20px;
                max-width: 400px;
                margin: 0 auto;
                margin-bottom: 30px;
            }
            .score-display {
                font-size: 24px;
                margin: 10px 0;
                color: #000;
            }
            .game-over {
                display: none;
                position: absolute;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
                background: rgba(255, 255, 255, 0.9);
                padding: 20px;
                border-radius: 10px;
                text-align: center;
            }
            .start-screen {
                position: absolute;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
                background: rgba(255, 255, 255, 0.9);
                padding: 20px;
                border-radius: 10px;
                text-align: center;
            }
            body {
                /* Remove overflow: hidden to allow scrolling */
            }
            .back {
                background-color: #000000;
                border-bottom-left-radius: 10px;
                border-bottom-right-radius: 10px;
            }
            /* Add styles to maintain navbar text color */
            #mainNav.navbar-shrink .nav-link:not(.active) {
                color: gray !important;
            }
            #mainNav.navbar-shrink .nav-link.active {
                color: #64a19d !important;
            }
            /* Ensure Home button text is visible */
            #mainNav .navbar-brand {
                color: gray !important;
            }
            #mainNav.navbar-shrink .navbar-brand {
                color: gray!important;
            }
        </style>
    </head>
    <body id="page-top">
        <!-- Navigation-->
        <nav class="navbar navbar-expand-lg navbar-light fixed-top" id="mainNav">
            <div class="container px-4 px-lg-5 back">
                <a class="navbar-brand" href="../index.html#page-top">Home</a>
                <button class="navbar-toggler navbar-toggler-right" type="button" data-bs-toggle="collapse" data-bs-target="#navbarResponsive" aria-controls="navbarResponsive" aria-expanded="false" aria-label="Toggle navigation">
                    Menu
                    <i class="fas fa-bars"></i>
                </button>
                <div class="collapse navbar-collapse" id="navbarResponsive">
                    <ul class="navbar-nav ms-auto">
                        <li class="nav-item"><a class="nav-link" href="../index.html#about">About</a></li>
                        <li class="nav-item"><a class="nav-link" href="scratch.html">Scratch</a></li>
                        <li class="nav-item"><a class="nav-link active" href="smileapp.html">SmileApp</a></li>
                        <li class="nav-item"><a class="nav-link" href="tab.html">Tableau</a></li>
                    </ul>
                </div>
            </div>
        </nav>

        <!-- Game Section-->
        <section class="projects-section bg-light">
            <div class="container px-4 px-lg-5">
                <div class="row gx-4 gx-lg-5 justify-content-center">
                    <div class="col-lg-8 text-center">
                        <h2 class="text-black mb-4">Flappy Smile</h2>
                        <p class="text-black-50 mb-5">Help the smiley face navigate through the totem poles! Press spacebar or click to jump.</p>
                        <div class="game-container">
                            <div class="score-display">Score: <span id="score">0</span></div>
                            <canvas id="gameCanvas" width="400" height="600"></canvas>
                            <div id="startScreen" class="start-screen">
                                <h3>Flappy Smile</h3>
                                <p>Press Spacebar or Click to Start</p>
                            </div>
                            <div id="gameOver" class="game-over">
                                <h3>Game Over!</h3>
                                <p>Your Score: <span id="finalScore">0</span></p>
                                <button onclick="restartGame()" class="btn btn-primary">Play Again</button>
                            </div>
                        </div>
                    </div>
                </div>
                <p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p>
            </div>
        </section>

        <!-- Footer-->
        <footer class="footer bg-black small text-center text-white-50">
            <div class="container px-4 px-lg-5">Copyright &copy; Carson Boehme 2024</div>
        </footer>

        <!-- Bootstrap core JS-->
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"></script>
        <!-- Core theme JS-->
        <script src="../js/scripts.js"></script>

        <script>
            const canvas = document.getElementById('gameCanvas');
            const ctx = canvas.getContext('2d');
            const startScreen = document.getElementById('startScreen');
            const gameOverScreen = document.getElementById('gameOver');
            const scoreDisplay = document.getElementById('score');
            const finalScoreDisplay = document.getElementById('finalScore');

            // Game variables
            let gameStarted = false;
            let gameOver = false;
            let score = 0;
            let gravity = 0.5;
            let velocity = 0;
            let position = 300;
            let pipes = [];
            let pipeGap = 200;
            let pipeWidth = 60;
            let pipeSpacing = 200; // Reduced spacing between pipes
            let lastPipe = 0;
            let gameSpeed = 2;

            // Smiley face properties
            const smileySize = 30;
            let smileyX = 100;

            // Event listeners
            document.addEventListener('keydown', handleInput);
            canvas.addEventListener('click', handleInput);

            function handleInput(e) {
                if (e.code === 'Space' || e.type === 'click') {
                    e.preventDefault(); // Prevent default spacebar behavior
                    if (!gameStarted) {
                        startGame();
                    } else if (!gameOver) {
                        velocity = -8;
                    }
                }
            }

            function startGame() {
                gameStarted = true;
                startScreen.style.display = 'none';
                // Initialize with first pipe
                createPipe();
                gameLoop();
            }

            function restartGame() {
                gameOver = false;
                score = 0;
                position = 300;
                velocity = 0;
                pipes = [];
                lastPipe = 0;
                gameSpeed = 2;
                scoreDisplay.textContent = '0';
                gameOverScreen.style.display = 'none';
                // Initialize with first pipe
                createPipe();
                gameLoop();
            }

            function createPipe() {
                const minHeight = 50;
                const maxHeight = canvas.height - pipeGap - minHeight;
                const height = Math.floor(Math.random() * (maxHeight - minHeight + 1)) + minHeight;

                pipes.push({
                    x: canvas.width,
                    topHeight: height,
                    bottomY: height + pipeGap,
                    passed: false
                });
            }

            function drawSmiley() {
                // Draw yellow circle
                ctx.beginPath();
                ctx.arc(smileyX, position, smileySize, 0, Math.PI * 2);
                ctx.fillStyle = '#FFD700';
                ctx.fill();
                ctx.stroke();

                // Draw eyes
                ctx.beginPath();
                ctx.arc(smileyX - 10, position - 5, 5, 0, Math.PI * 2);
                ctx.arc(smileyX + 10, position - 5, 5, 0, Math.PI * 2);
                ctx.fillStyle = '#000';
                ctx.fill();

                // Draw smile
                ctx.beginPath();
                ctx.arc(smileyX, position + 5, 15, 0, Math.PI);
                ctx.stroke();
            }

            function drawTotemPole(x, y, height, isTop) {
                const colors = ['#8B4513', '#A0522D', '#CD853F'];
                const segmentHeight = 40;
                const segments = Math.ceil(height / segmentHeight);
                
                for (let i = 0; i < segments; i++) {
                    const currentY = isTop ? y - (i * segmentHeight) : y + (i * segmentHeight);
                    if (isTop && currentY < 0) break;
                    if (!isTop && currentY > canvas.height) break;

                    // Draw pole segment
                    ctx.fillStyle = colors[i % colors.length];
                    ctx.fillRect(x, currentY, pipeWidth, segmentHeight);
                    
                    // Draw frowning face on each segment
                    ctx.fillStyle = '#000';
                    // Eyes
                    ctx.beginPath();
                    ctx.arc(x + 15, currentY + 15, 3, 0, Math.PI * 2);
                    ctx.arc(x + 45, currentY + 15, 3, 0, Math.PI * 2);
                    ctx.fill();
                    
                    // Frown
                    ctx.beginPath();
                    ctx.arc(x + 30, currentY + 35, 10, Math.PI, Math.PI * 2);
                    ctx.stroke();
                }
            }

            function checkCollision(pipe) {
                const smileyRight = smileyX + smileySize;
                const smileyLeft = smileyX - smileySize;
                const smileyTop = position - smileySize;
                const smileyBottom = position + smileySize;

                if (smileyRight > pipe.x && smileyLeft < pipe.x + pipeWidth) {
                    if (smileyTop < pipe.topHeight || smileyBottom > pipe.bottomY) {
                        return true;
                    }
                }
                return false;
            }

            function gameLoop() {
                if (gameOver) return;

                // Clear canvas
                ctx.clearRect(0, 0, canvas.width, canvas.height);

                // Update position
                velocity += gravity;
                position += velocity;

                // Draw background
                ctx.fillStyle = '#87CEEB';
                ctx.fillRect(0, 0, canvas.width, canvas.height);

                // Create new pipes
                if (pipes.length === 0 || canvas.width - (pipes[pipes.length - 1].x + pipeWidth) > pipeSpacing) {
                    createPipe();
                }

                // Update and draw pipes
                for (let i = pipes.length - 1; i >= 0; i--) {
                    const pipe = pipes[i];
                    pipe.x -= gameSpeed;

                    // Draw totem poles
                    drawTotemPole(pipe.x, pipe.topHeight, pipe.topHeight, true);
                    drawTotemPole(pipe.x, pipe.bottomY, canvas.height - pipe.bottomY, false);

                    // Check collision
                    if (checkCollision(pipe)) {
                        endGame();
                        return;
                    }

                    // Update score
                    if (!pipe.passed && pipe.x + pipeWidth < smileyX) {
                        pipe.passed = true;
                        score++;
                        scoreDisplay.textContent = score;
                        // Increase game speed slightly with each point
                        gameSpeed = Math.min(4, 2 + (score * 0.1));
                    }

                    // Remove off-screen pipes
                    if (pipe.x + pipeWidth < 0) {
                        pipes.splice(i, 1);
                    }
                }

                // Check boundaries
                if (position + smileySize > canvas.height || position - smileySize < 0) {
                    endGame();
                    return;
                }

                // Draw smiley
                drawSmiley();

                requestAnimationFrame(gameLoop);
            }

            function endGame() {
                gameOver = true;
                finalScoreDisplay.textContent = score;
                gameOverScreen.style.display = 'block';
            }
        </script>
    </body>
</html>
